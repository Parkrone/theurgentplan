<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parker's Financial Dashboard</title>
    
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 2. React & ReactDOM (Global CDN) -->
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>

    <!-- 3. Prop Types (Required dependency for Recharts) -->
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    
    <!-- 4. Recharts (Global CDN) -->
    <script src="https://unpkg.com/recharts@2.10.3/umd/Recharts.js"></script>

    <!-- 5. Babel (For JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f8fafc; color: #1e293b; margin: 0; }
        .loading-screen { display: flex; justify-content: center; align-items: center; height: 100vh; font-size: 1.2rem; color: #64748b; }
        .markdown-body ul { list-style-type: disc; margin-left: 1.5em; }
        .markdown-body p { margin-bottom: 0.8em; }
        @keyframes fillProgress { from { width: 0; } to { width: var(--progress); } }
        .progress-bar { animation: fillProgress 1.5s ease-out forwards; }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: { 50: '#f8fafc', 100: '#f1f5f9', 800: '#1e293b', 900: '#0f172a' },
                        gold: { 400: '#FACC15', 500: '#EAB308' }
                    }
                }
            }
        }
    </script>
</head>
<body>
    <div id="root">
        <div class="loading-screen">Loading Dashboard...</div>
    </div>

    <script type="text/babel">
        // --- GLOBAL VARIABLE SETUP ---
        const { useState, useEffect } = React;
        const { createRoot } = ReactDOM;
        const { 
            BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, 
            ResponsiveContainer, PieChart, Pie, Cell 
        } = Recharts;

        // --- ICON COMPONENTS ---
        const IconWrapper = ({ children, color, className }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width="24" height="24" viewBox="0 0 24 24" 
                fill="none" stroke={color || "currentColor"} strokeWidth="2" 
                strokeLinecap="round" strokeLinejoin="round" 
                className={className}
            >
                {children}
            </svg>
        );

        const AlertCircle = (props) => <IconWrapper {...props}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></IconWrapper>;
        const CheckCircle = (props) => <IconWrapper {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></IconWrapper>;
        const TrendingUp = (props) => <IconWrapper {...props}><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></IconWrapper>;
        const DollarSign = (props) => <IconWrapper {...props}><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></IconWrapper>;
        const Shield = (props) => <IconWrapper {...props}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></IconWrapper>;
        const Car = (props) => <IconWrapper {...props}><rect x="1" y="3" width="15" height="13"></rect><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon><circle cx="5.5" cy="18.5" r="2.5"></circle><circle cx="18.5" cy="18.5" r="2.5"></circle></IconWrapper>;
        const Briefcase = (props) => <IconWrapper {...props}><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></IconWrapper>;
        const Info = (props) => <IconWrapper {...props}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></IconWrapper>;
        const Home = (props) => <IconWrapper {...props}><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></IconWrapper>;
        const Smartphone = (props) => <IconWrapper {...props}><rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect><line x1="12" y1="18" x2="12.01" y2="18"></line></IconWrapper>;
        const GraduationCap = (props) => <IconWrapper {...props}><path d="M22 10v6M2 10l10-5 10 5-10 5z"></path><path d="M6 12v5c3 3 9 3 12 0v-5"></path></IconWrapper>;
        const Sparkles = (props) => <IconWrapper {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path></IconWrapper>;
        const MessageSquare = (props) => <IconWrapper {...props}><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></IconWrapper>;
        const Loader2 = (props) => <IconWrapper {...props} className={`${props.className || ''} animate-spin`}><path d="M21 12a9 9 0 1 1-6.219-8.56"></path></IconWrapper>;
        const X = (props) => <IconWrapper {...props}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></IconWrapper>;
        const Trophy = (props) => <IconWrapper {...props}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path><path d="M4 22h16"></path><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path></IconWrapper>;
        const Utensils = (props) => <IconWrapper {...props}><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2" /><path d="M7 2v20" /><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7" /></IconWrapper>;

        const FinancialDashboard = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [aiLoading, setAiLoading] = useState(false);
            const [aiAnalysis, setAiAnalysis] = useState(null);
            const [scriptLoadingId, setScriptLoadingId] = useState(null);
            const [activeScript, setActiveScript] = useState(null);

            // --- DEBT DATA ---
            const [debts, setDebts] = useState([
                { id: 1, name: 'Affirm (Overdue)', amount: 819, overdue: 226.46, originalAmount: 819, priority: 'High' },
                { id: 2, name: 'Possible (Overdue)', amount: 150, overdue: 112.50, originalAmount: 150, priority: 'High' },
                // RENT PAID OFF! Updated originalAmount to $700 per user request
                { id: 3, name: 'Rent Balance', amount: 0, overdue: 0, originalAmount: 700, priority: 'Paid', paidDate: 'Dec 4, 2025 â€¢ 9:38 PM' },
                { id: 4, name: 'USAA CC', amount: 5192.15, overdue: 0, originalAmount: 5192.15, priority: 'Medium' },
                { id: 5, name: 'Zip Financial', amount: 260.48, overdue: 0, originalAmount: 260.48, priority: 'Low' },
                { id: 6, name: 'Klarna', amount: 95.68, overdue: 0, originalAmount: 95.68, priority: 'Low' },
                { id: 7, name: 'SoLo Financial', amount: 136.20, overdue: 0, originalAmount: 136.20, priority: 'Low' },
                { id: 8, name: 'Robinhood', amount: 302.25, overdue: 0, originalAmount: 302.25, priority: 'Low' },
                { id: 9, name: 'AMEX + BILT', amount: 82.21, overdue: 0, originalAmount: 82.21, priority: 'Low' },
                { id: 10, name: 'Student Loans (Mohela)', amount: 5283, overdue: 0, originalAmount: 5283, priority: 'Medium' },
            ]);

            const [assets, setAssets] = useState([
                { id: 1, name: 'Workstation PC (Collateral)', value: 2800, selected: true },
                { id: 6, name: 'Laptop (Listed for Sale)', value: 800, selected: false },
                { id: 2, name: 'Traxxas RC Car', value: 500, selected: true },
                { id: 3, name: 'Marshall Amp', value: 250, selected: false },
                { id: 4, name: 'Xbox One S', value: 150, selected: false },
                { id: 5, name: 'Extra Monitor', value: 120, selected: false },
            ]);

            const monthlyFixed = [
                { name: 'Rent & Utilities', amount: 700, icon: Home },
                { name: 'Phone, Internet, TV', amount: 100, icon: Smartphone },
                { name: 'Mohela Loan', amount: 70, icon: GraduationCap },
                { name: 'Food & Groceries', amount: 370, icon: Utensils },
                { name: 'Travel & Gas', amount: 250, icon: Car },
            ];
            const totalMonthlyFixed = monthlyFixed.reduce((acc, item) => acc + item.amount, 0);

            // --- CALCULATIONS ---
            const totalDebt = debts.reduce((acc, curr) => acc + curr.amount, 0);
            const totalOverdue = debts.reduce((acc, curr) => acc + curr.overdue, 0);
            const totalOriginal = debts.reduce((acc, curr) => acc + (curr.originalAmount || curr.amount), 0);
            const totalPaidOff = totalOriginal - totalDebt;
            
            const activeDebts = debts.filter(d => d.amount > 0);
            const paidDebts = debts.filter(d => d.amount === 0);

            const selectedCollateral = assets.filter(a => a.selected).reduce((acc, curr) => acc + curr.value, 0);
            const immediateNeed = totalOverdue; 
            const coverageRatio = immediateNeed > 0 ? (selectedCollateral / immediateNeed).toFixed(1) : "Secure";

            const projectionData = [
                { month: 'Month 1', income: 2400, expenses: 2000, savings: 0, debtPayoff: 400 },
                { month: 'Month 2', income: 2400, expenses: 1800, savings: 100, debtPayoff: 500 },
                { month: 'Month 3', income: 4000, expenses: 1900, savings: 800, debtPayoff: 1300 },
                { month: 'Month 4', income: 4200, expenses: 1900, savings: 1000, debtPayoff: 1300 },
                { month: 'Month 5', income: 4200, expenses: 1900, savings: 1500, debtPayoff: 800 },
            ];

            const COLORS = ['#FF8042', '#FFBB28', '#00C49F', '#0088FE', '#8884d8'];
            const apiKey = "AIzaSyDG1VmAS9f4hbdkbO5_VU5h4hvWyVtbsGs"; 

            // --- API & HANDLERS ---
            const callGemini = async (prompt) => {
                if (!apiKey) { alert("Please open index.html and add your API key."); return "Error: API Key missing."; }
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    });
                    if (!response.ok) throw new Error('API Call Failed');
                    const data = await response.json();
                    return data.candidates[0].content.parts[0].text;
                } catch (error) { console.error(error); return "Unable to generate response. Please check your API key."; }
            };

            const handleAnalyzeFinances = async () => {
                setAiLoading(true);
                const financialContext = `I have $${immediateNeed.toFixed(2)} in immediate overdue bills. Collateral: $${selectedCollateral}. Total debt: $${totalDebt.toLocaleString()}. Goal: Car in Month 5.`;
                const prompt = `Act as a financial advisor. Analyze this:\n${financialContext}\n\nProvide 3 distinct, actionable bullet points (max 100 words total) on how to navigate the next 30 days. Use emojis.`;
                const result = await callGemini(prompt);
                setAiAnalysis(result);
                setAiLoading(false);
            };

            const handleGenerateScript = async (debt) => {
                setScriptLoadingId(debt.id);
                const prompt = `Write a polite phone script to negotiate a payment plan for $${debt.overdue} with ${debt.name}. Offer $50 today.`;
                const result = await callGemini(prompt);
                setActiveScript({ id: debt.id, text: result, creditor: debt.name });
                setScriptLoadingId(null);
            };

            // --- COMPONENTS ---
            const KPICard = ({ title, value, subtext, icon: Icon, color }) => (
                <div className={`p-4 rounded-xl shadow-sm border-l-4 bg-white`} style={{ borderColor: color }}>
                    <div className="flex justify-between items-start">
                        <div>
                            <p className="text-gray-500 text-sm font-medium">{title}</p>
                            <h3 className="text-2xl font-bold mt-1" style={{ color: color }}>{value}</h3>
                            <p className="text-xs text-gray-400 mt-1">{subtext}</p>
                        </div>
                        {Icon && <Icon className="w-6 h-6 opacity-50" color={color} />}
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen bg-gray-50 text-gray-800 font-sans">
                <header className="bg-slate-900 text-white p-6 shadow-lg">
                    <div className="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center">
                    <div>
                        <h1 className="text-3xl font-bold flex items-center gap-2">
                        <Briefcase className="text-blue-400" /> Parker's Financial Dashboard
                        </h1>
                        <p className="text-slate-400 mt-1">Current Status, Assets & 5-Month Recovery Plan</p>
                    </div>
                    <div className="flex gap-4 mt-4 md:mt-0">
                        <button onClick={() => setActiveTab('dashboard')} className={`px-4 py-2 rounded-lg transition ${activeTab === 'dashboard' ? 'bg-blue-600 font-bold' : 'bg-slate-800 hover:bg-slate-700'}`}>Overview</button>
                        <button onClick={() => setActiveTab('debts')} className={`px-4 py-2 rounded-lg transition ${activeTab === 'debts' ? 'bg-blue-600 font-bold' : 'bg-slate-800 hover:bg-slate-700'}`}>Assets & Liabilities</button>
                        <button onClick={() => setActiveTab('plan')} className={`px-4 py-2 rounded-lg transition ${activeTab === 'plan' ? 'bg-blue-600 font-bold' : 'bg-slate-800 hover:bg-slate-700'}`}>The Plan</button>
                    </div>
                    </div>
                </header>

                <main className="max-w-6xl mx-auto p-6">
                    {/* DASHBOARD VIEW */}
                    {activeTab === 'dashboard' && (
                    <div className="space-y-6">
                        {/* GAMIFICATION BANNER */}
                        {totalPaidOff > 0 && (
                            <div className="bg-gradient-to-r from-emerald-500 to-teal-600 rounded-xl p-4 text-white flex items-center justify-between shadow-lg">
                                <div className="flex items-center gap-4">
                                    <div className="bg-white/20 p-3 rounded-full"><Trophy className="w-6 h-6 text-yellow-300" /></div>
                                    <div>
                                        <h2 className="font-bold text-lg">Total Debt Crushed: ${totalPaidOff.toLocaleString()}</h2>
                                        <p className="text-emerald-100 text-sm">Keep going! You are making real progress.</p>
                                    </div>
                                </div>
                                <div className="text-right">
                                    <span className="text-3xl font-bold">{((totalPaidOff / totalOriginal) * 100).toFixed(1)}%</span>
                                    <span className="block text-xs text-emerald-100">Paid Off</span>
                                </div>
                            </div>
                        )}

                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <KPICard title="Immediate Need" value={`$${immediateNeed.toFixed(0)}`} subtext="Overdue Bills Only" icon={Info} color="#F59E0B" />
                            <KPICard title="Asset Security" value={`$${selectedCollateral}`} subtext="Value Backing the Loan" icon={Shield} color="#10B981" />
                            <KPICard title="Total Debt" value={`$${totalDebt.toLocaleString()}`} subtext="Remaining Balance" icon={DollarSign} color="#EF4444" />
                            <KPICard title="Transport Goal" value="Month 5" subtext="Car Purchase Plan" icon={Car} color="#8B5CF6" />
                        </div>

                        {/* AI STRATEGY CARD */}
                        <div className="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-xl p-6 shadow-md text-white">
                            <div className="flex justify-between items-start mb-4">
                                <h2 className="text-xl font-bold flex items-center gap-2"><Sparkles className="w-5 h-5 text-yellow-300" /> AI Strategy Advisor</h2>
                                {!aiAnalysis && <button onClick={handleAnalyzeFinances} disabled={aiLoading} className="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg font-semibold text-sm transition flex items-center gap-2">{aiLoading ? <Loader2 className="w-4 h-4 animate-spin" /> : <Sparkles className="w-4 h-4" />} Analyze My Situation</button>}
                            </div>
                            {aiLoading && <div className="text-indigo-100 italic animate-pulse">Crunching numbers...</div>}
                            {aiAnalysis && <div className="bg-white/10 p-4 rounded-lg border border-white/20 backdrop-blur-sm"><div className="markdown-body text-indigo-50 leading-relaxed whitespace-pre-wrap">{aiAnalysis}</div><button onClick={() => setAiAnalysis(null)} className="mt-4 text-xs text-indigo-200 hover:text-white underline">Reset</button></div>}
                        </div>

                        {/* Monthly Fixed Costs Summary */}
                        <div className="bg-white p-5 rounded-xl shadow-sm border border-gray-200 flex flex-col md:flex-row justify-between items-center gap-4">
                            <div className="flex items-center gap-3">
                                <div className="p-3 bg-purple-100 rounded-lg"><TrendingUp className="w-6 h-6 text-purple-600" /></div>
                                <div><h3 className="font-bold text-gray-700 text-lg">Monthly Fixed Costs</h3><p className="text-xs text-gray-500">Recurring payments</p></div>
                            </div>
                            <div className="flex-1 flex flex-wrap justify-center gap-8 text-sm">
                                {monthlyFixed.map((item, idx) => (
                                <div key={idx} className="flex items-center gap-2"><div className="bg-slate-100 p-1.5 rounded-full"><item.icon className="w-4 h-4 text-slate-500" /></div><div><span className="block text-gray-500 text-xs">{item.name}</span><span className="font-bold text-gray-800">${item.amount}</span></div></div>
                                ))}
                            </div>
                            <div className="text-right pl-6 md:border-l md:border-gray-100"><span className="block text-gray-400 text-xs uppercase tracking-wider">Total Monthly</span><span className="text-2xl font-bold text-purple-600">${totalMonthlyFixed}</span></div>
                        </div>

                        {/* Main Action Alert (Restored) */}
                        <div className="bg-white border-l-4 border-blue-500 p-6 rounded-xl shadow-sm flex flex-col md:flex-row items-center gap-8">
                            <div className="flex-1">
                                <h2 className="text-xl font-bold text-slate-800 mb-2">Proposal: Secured Bridge Loan</h2>
                                <p className="text-slate-600 mb-4 leading-relaxed">
                                Due to payroll delays, I am proposing a <strong>$1,000 family bridge loan</strong> to resolve this without incurring high-interest debt.
                                </p>
                                <div className="bg-slate-50 p-4 rounded-lg border border-slate-200 space-y-3">
                                    <div className="flex items-start gap-3">
                                        <CheckCircle className="w-5 h-5 text-green-500 mt-0.5" />
                                        <div><span className="font-bold text-slate-700">Fully Secured:</span><p className="text-sm text-slate-500">Backed by Workstation PC & RC Car (Value: $3,300). Assets exceed loan value by {coverageRatio}x.</p></div>
                                    </div>
                                </div>
                            </div>
                            <div className="w-full md:w-1/3 h-64">
                                <ResponsiveContainer width="100%" height="100%">
                                    <PieChart>
                                    <Pie data={[{ name: 'Rent', value: 449 }, { name: 'Overdue Bills', value: 339 }, { name: 'Living Buffer', value: 212 }]} cx="50%" cy="50%" innerRadius={60} outerRadius={80} paddingAngle={5} dataKey="value">
                                        {projectionData.map((entry, index) => <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />)}
                                    </Pie>
                                    <Tooltip formatter={(value) => `$${value}`} />
                                    <Legend verticalAlign="bottom" height={36}/>
                                    </PieChart>
                                </ResponsiveContainer>
                                <p className="text-center text-xs text-gray-500 mt-2">Allocation of $1,000 Bridge Funds</p>
                            </div>
                        </div>
                    </div>
                    )}

                    {/* DEBTS & ASSETS VIEW */}
                    {activeTab === 'debts' && (
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                            <h3 className="text-lg font-bold mb-4 flex items-center gap-2"><Shield className="w-5 h-5 text-blue-500" /> Assets & Collateral</h3>
                            <div className="space-y-3">
                                {assets.map(asset => (
                                <div key={asset.id} onClick={() => setAssets(assets.map(a => a.id === asset.id ? {...a, selected: !a.selected} : a))} className={`flex justify-between items-center p-3 rounded-lg border cursor-pointer transition ${asset.selected ? 'bg-blue-50 border-blue-500 ring-1 ring-blue-500' : 'bg-gray-50 border-gray-200 hover:bg-gray-100'}`}>
                                    <div className="flex items-center gap-3"><div className={`w-4 h-4 rounded-full border flex items-center justify-center ${asset.selected ? 'bg-blue-500 border-blue-500' : 'bg-white border-gray-400'}`}>{asset.selected && <div className="w-2 h-2 bg-white rounded-full" />}</div><span className="font-medium">{asset.name}</span></div>
                                    <span className="font-bold text-gray-700">${asset.value}</span>
                                </div>
                                ))}
                            </div>
                            <div className="mt-6 pt-4 border-t flex justify-between items-center"><span className="text-gray-500">Total Security Value:</span><span className="text-2xl font-bold text-green-600">${selectedCollateral}</span></div>
                        </div>

                        <div className="space-y-6">
                            {/* VICTORY LAP SECTION */}
                            {paidDebts.length > 0 && (
                                <div className="bg-yellow-50 border border-yellow-200 rounded-xl p-6 shadow-sm">
                                    <h3 className="text-lg font-bold mb-4 flex items-center gap-2 text-yellow-800">
                                        <Trophy className="w-5 h-5 text-yellow-600" /> 
                                        Victory Lap: Paid Off!
                                    </h3>
                                    <div className="space-y-3">
                                        {paidDebts.map(debt => (
                                            <div key={debt.id} className="bg-white p-3 rounded-lg border border-yellow-100 flex justify-between items-center">
                                                <div>
                                                    <span className="font-medium text-slate-700 line-through decoration-slate-400 block">{debt.name}</span>
                                                    {debt.paidDate && <span className="text-xs text-slate-400">Cleared: {debt.paidDate}</span>}
                                                </div>
                                                <div className="text-right">
                                                    <span className="block font-bold text-green-700">${debt.originalAmount}</span>
                                                    <span className="bg-green-100 text-green-700 text-xs font-bold px-2 py-1 rounded inline-flex items-center gap-1 mt-1">
                                                        <CheckCircle className="w-3 h-3" /> PAID
                                                    </span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                                <h3 className="text-lg font-bold mb-4 flex items-center gap-2"><AlertCircle className="w-5 h-5 text-orange-500" /> Active Liabilities</h3>
                                
                                {activeScript && (
                                    <div className="mb-6 bg-slate-800 text-slate-100 p-4 rounded-lg relative border border-slate-700">
                                    <button onClick={() => setActiveScript(null)} className="absolute top-2 right-2 text-slate-400 hover:text-white"><X className="w-4 h-4" /></button>
                                    <h4 className="font-bold flex items-center gap-2 mb-2 text-yellow-400"><MessageSquare className="w-4 h-4" /> Script for {activeScript.creditor}:</h4>
                                    <div className="text-sm whitespace-pre-wrap font-mono bg-black/30 p-3 rounded">"{activeScript.text}"</div>
                                    </div>
                                )}

                                <div className="overflow-x-auto">
                                    <table className="w-full text-sm">
                                    <thead>
                                        <tr className="bg-gray-50 text-left">
                                            <th className="p-3">Creditor</th>
                                            <th className="p-3">Total Balance</th>
                                            <th className="p-3">Due Now</th>
                                            <th className="p-3">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {activeDebts.sort((a,b) => b.overdue - a.overdue).map((debt) => (
                                        <tr key={debt.id} className="border-b last:border-0 hover:bg-gray-50">
                                            <td className="p-3 font-medium">{debt.name}</td>
                                            <td className="p-3 font-semibold text-slate-700">${debt.amount.toLocaleString()}</td>
                                            <td className={`p-3 font-bold ${debt.overdue > 0 ? 'text-orange-500' : 'text-gray-400'}`}>${debt.overdue.toLocaleString()}</td>
                                            <td className="p-3">
                                            {debt.overdue > 0 && (
                                                <button onClick={() => handleGenerateScript(debt)} disabled={scriptLoadingId === debt.id} className="text-xs bg-indigo-50 hover:bg-indigo-100 text-indigo-700 px-2 py-1 rounded border border-indigo-200 flex items-center gap-1 transition">
                                                {scriptLoadingId === debt.id ? <Loader2 className="w-3 h-3 animate-spin" /> : <Sparkles className="w-3 h-3" />} Script
                                                </button>
                                            )}
                                            </td>
                                        </tr>
                                        ))}
                                    </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    )}

                    {/* PLAN VIEW */}
                    {activeTab === 'plan' && (
                    <div className="space-y-8">
                        <div className="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                            <h3 className="text-lg font-bold mb-6">Income vs. Savings Projection</h3>
                            <div className="h-80 w-full"><ResponsiveContainer width="100%" height="100%"><BarChart data={projectionData} margin={{ top: 20, right: 30, left: 20, bottom: 5 }}><CartesianGrid strokeDasharray="3 3" vertical={false} /><XAxis dataKey="month" /><YAxis /><Tooltip /><Legend /><Bar dataKey="income" name="Income" fill="#3B82F6" radius={[4, 4, 0, 0]} /><Bar dataKey="savings" name="Savings" fill="#10B981" radius={[4, 4, 0, 0]} /></BarChart></ResponsiveContainer></div>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div className="bg-gradient-to-br from-slate-800 to-slate-900 text-white p-6 rounded-xl">
                                <h3 className="text-xl font-bold mb-4">ðŸš— Future Goal: Transport Strategy</h3>
                                <div className="space-y-4">
                                <div className="flex items-center gap-4"><div className="bg-white/10 p-3 rounded-lg"><span className="text-xl font-bold">Phase 1</span></div><div><p className="font-medium text-blue-200">Stabilization (Months 1-2)</p><p className="text-sm text-gray-400">Stabilize rent and clear small debts.</p></div></div>
                                <div className="flex items-center gap-4"><div className="bg-white/10 p-3 rounded-lg"><span className="text-xl font-bold text-green-400">Phase 2</span></div><div><p className="font-medium text-green-300">Income Jump (Month 3)</p><p className="text-sm text-gray-400">Manager promotion ($25/hr). Start saving.</p></div></div>
                                <div className="flex items-center gap-4"><div className="bg-white/10 p-3 rounded-lg"><span className="text-xl font-bold text-purple-400">Phase 3</span></div><div><p className="font-medium text-purple-300">Purchase (Month 5)</p><p className="text-sm text-gray-400">Target Reached: ~$1,500 Cash.</p></div></div>
                                </div>
                            </div>
                            <div className="bg-white p-6 rounded-xl border border-gray-200">
                                <h3 className="font-bold mb-4 text-slate-800">Responsible Debt Management</h3>
                                <ol className="list-decimal pl-5 space-y-4 text-sm"><li className="text-slate-600">Immediate Stabilization: Utilize the bridge loan to clear rent.</li><li className="text-slate-600">Liquidation: Sell assets to pay back bridge loan.</li><li className="text-slate-600">High-Interest Focus: Allocate raise to remaining debts.</li></ol>
                            </div>
                        </div>
                    </div>
                    )}
                </main>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<FinancialDashboard />);
    </script>
</body>
</html>
